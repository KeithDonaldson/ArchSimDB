<metal:macro use-macro="master">
    <metal:slot fill-slot="title">
        <title>Query | ArchSim DB</title>
    </metal:slot>

    <metal:slot fill-slot="head">
        <!-- DataTables CSS -->
        <link href="${request.static_url('proj:static/vendor/datatables-plugins/dataTables.bootstrap.css')}" rel="stylesheet">
        <link href="${request.static_url('proj:static/vendor/datatables-responsive/dataTables.responsive.css')}" rel="stylesheet">
    </metal:slot>

    <metal:slot fill-slot="scripts">
        <!-- DataTables JavaScript -->
        <script src="${request.static_url('proj:static/vendor/datatables/js/jquery.dataTables.min.js')}"></script>
        <script src="${request.static_url('proj:static/vendor/datatables-plugins/dataTables.bootstrap.min.js')}"></script>
        <script src="${request.static_url('proj:static/vendor/datatables-responsive/dataTables.responsive.js')}"></script>

        <script type="text/javascript" id="exp_list" exps="${experiments}">
            var data = JSON.parse($("#exp_list").attr("exps"));
            $(document).ready(function() {
                $('#experiment_table').DataTable({
                    data: data,
                    columns: [
                        { data: '_exp_name',
                          'render': function (data) {
                                return '<a onclick="getConfs(\'' + data + '\')" style="cursor: pointer">' + data + '</a>';
                            }
                        },
                        { data: '_exp_owner' },
                        { data: '_exp_date' }
                    ],
                    responsive: true
                });
            });

            function getConfs(_exp_name) {
                $.post( "get/configurations", { '_exp_name': _exp_name }, function( data ) {
                    var parsed_data = JSON.parse(data)
                    $("#configurations").slideDown("slow", function() {});
                    $('#configuration_table').DataTable({
                        data: parsed_data,
                        columns: [
                            { data: '_conf_name',
                              'render': function (data) {
                                  return '<a onclick="getApps(\'' + data + '\')" style="cursor: pointer">' + data + '</a>';
                              }
                            },
                            { data: '_conf_owner' },
                            { data: '_exp_name' },
                            { data: '_conf_date' }
                        ],
                        responsive: true
                    });
                    $("#experiments").css("pointer-events", "none");
                    $("#experiments").css("opacity", "0.4");
                    $("#conf_title").text("Configurations of " + _exp_name)
                });
            };

            function getApps(_conf_name) {
                $.post( "get/applications", { '_conf_name': _conf_name }, function( data ) {
                    var parsed_data = JSON.parse(data)
                    $("#applications").slideDown("slow", function() {});
                    $('#application_table').DataTable({
                        data: parsed_data,
                        columns: [
                            { data: '_sim_name' },
                            { data: '_sim_owner' },
                            { data: '_conf_name' },
                            { data: '_exp_name' },
                            { data: '_sim_date' }
                        ],
                        responsive: true
                    });
                    $("#configurations").css("pointer-events", "none");
                    $("#configurations").css("opacity", "0.4");
                    $("#app_title").text("Applications of " + _conf_name)
                });
            };
        </script>
    </metal:slot>

    <metal:slot fill-slot="body">
        <div class="row">
            <div class="col-lg-12">
                <h1 class="page-header">Query</h1>
            </div>
            <!-- /.col-lg-12 -->
        </div>
        <!-- /.row -->
        <div class="row" id="experiments">
            <div class="col-lg-12">
                <h2>Experiments</h2>
                <table width="100%" class="table table-striped table-bordered table-hover" id="experiment_table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Owner</th>
                            <th>Date</th>
                        </tr>
                    </thead>
                </table>
            </div>
            <!-- /.col-lg-12 -->
        </div>
        <div class="row" id="configurations" style="display: none;">
            <div class="col-lg-12">
                <hr />
                <h2 id="conf_title">Configurations</h2>
                <table width="100%" class="table table-striped table-bordered table-hover" id="configuration_table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Owner</th>
                            <th>Experiment Name</th>
                            <th>Date</th>
                        </tr>
                    </thead>
                </table>
            </div>
            <!-- /.col-lg-12 -->
        </div>
        <div class="row" id="applications" style="display: none;">
            <div class="col-lg-12">
                <hr />
                <h2 id="app_title">Configurations</h2>
                <table width="100%" class="table table-striped table-bordered table-hover" id="application_table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Owner</th>
                            <th>Configuration Name</th>
                            <th>Experiment Name</th>
                            <th>Date</th>
                        </tr>
                    </thead>
                </table>
            </div>
            <!-- /.col-lg-12 -->
        </div>
    </metal:slot>
</metal:macro>